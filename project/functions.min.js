var functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a={events:{resetGame:function(d,c,a,f,g){core.clearStatus();core.status=core.clone(core.initStatus,function(h){return h!="hero"&&h!="maps"});core.status.played=true;core.status.hero=core.clone(d);core.events.setHeroIcon(core.getFlag("heroIcon","hero.png"),true);core.control._initStatistics(core.animateFrame.totalTime);core.status.hero.statistics.totalTime=core.animateFrame.totalTime=Math.max(core.status.hero.statistics.totalTime,core.animateFrame.totalTime);core.status.hero.statistics.start=null;core.status.hard=c||"";core.status.floorId=a;core.status.maps=f;core.material.enemys=core.enemys.getEnemys();core.material.items=core.items.getItems();core.items._resetItems();core.values=core.clone(core.data.values);for(var e in g||{}){core.values[e]=g[e]}core.flags=core.clone(core.data.flags);var b=core.getFlag("globalFlags",{});for(var e in b){core.flags[e]=b[e]}core._init_sys_flags();core.resize();core.updateGlobalAttribute();if(core.hasFlag("hideStatusBar")){core.hideStatusBar(core.hasFlag("showToolbox"))}else{core.showStatusBar()}core.dom.musicBtn.style.display="none"},setInitData:function(){if(core.status.hard=="Blind"){core.setFlag("hard",1);core.setItem("I_hard_1",1)}if(core.status.hard=="Easy"){core.setFlag("hard",2);core.setItem("I_hard_2",1)}if(core.status.hard=="Hard"){core.setFlag("hard",3)}core.setFlag("__visited__",{});core.updateEnemys()},win:function(b,a){core.ui.closePanel();var c=core.isReplaying();if(c){core.stopReplay()}core.waitHeroToStop(function(){core.clearMap("all");core.deleteAllCanvas();core.dom.gif2.innerHTML="";var e=core.status.hero.hp+core.getFlag("hp_score",0);var d="正在统计分数……\n溢出生命和剩余生命值共"+e+"点，转化为等量分数\n";if(b=="蓝海王中王"){e+=100000*core.itemCount("yellowKey");d+=core.itemCount("yellowKey")+"把黄钥匙，共"+100000*core.itemCount("yellowKey")+"分\n"}else{if(b=="红海王中王"){e+=1000000*core.itemCount("yellowKey")+4000000*core.itemCount("blueKey");d+=core.itemCount("yellowKey")+"把黄钥匙，共"+1000000*core.itemCount("yellowKey")+"分\n";d+=core.itemCount("blueKey")+"把蓝钥匙，共"+4000000*core.itemCount("blueKey")+"分\n";e+=2500*core.itemCount("coin")+1000000*core.itemCount("talentPoint")*core.itemCount("talentPoint");d+=core.itemCount("coin")+"金币，共"+2500*core.itemCount("coin")+"分\n";d+=core.itemCount("talentPoint")+"剩余天赋点，共"+1000000*core.itemCount("talentPoint")*core.itemCount("talentPoint")+"分\n"}}d+="总计分数："+e;core.setStatus("hpmax",-1);core.setStatus("hp",e);if(b=="血海王中王"){core.drawText(["\t[技不如人，如沐东风,I342]您好，这里是本游戏的作者。","\t[技不如人，如沐东风,I342]恭喜您在最高难度下取得了不亚于作者的成绩，请容辣鸡作者膜拜一下大佬。大佬如果有任何想法，不论话本身好听与否，辣鸡作者都希望您在评论区分享一下。辣鸡作者以后不会再造塔了，所以请不要给我留面子，您的意见很可能会对其他造塔者有很大帮助，相信我们有着共同的目的——以后能有更多高质量塔出现。","\t[技不如人，如沐东风,I342]感谢您玩到这里。",d,"\t["+(b||"恭喜通关")+"]你的分数是${status:hp}。"],function(){core.events.gameOver(b||"",c,a)})}else{if(b=="伯力征服者"&&core.getFlag("hard",0)==3){core.drawText(["\t[系统提示]恭喜您已通关最高难度。到这里相信您已经体会到，这个塔虽然初看上去比较恐怖，其实难度并不大。欢迎您到评论区发表看法。另外，如果您在最高难度的每个章节都打出不亚于作者的成绩，榜单会单独列出。","\t[系统提示]单独列出榜单的条件：\n萌新篇：回到莫家之前溢出生命值大于1500\n蓝海篇：踏入传送阵时溢出生命值大于17万，满血满蓝，黄钥匙至少6把\n红海篇：损失少于10万血击破大阵\n血海篇：击败孔阳后当前生命+溢出生命大于3.65亿",d,"\t["+(b||"恭喜通关")+"]你的分数是${status:hp}。"],function(){core.events.gameOver(b||"",c,a)})}else{core.drawText([d,"\t["+(b||"恭喜通关")+"]你的分数是${status:hp}。"],function(){core.events.gameOver(b||"",c,a)})}}})},lose:function(a){core.ui.closePanel();var b=core.isReplaying();core.stopReplay();core.waitHeroToStop(function(){core.drawText(["\t["+(a||"暴毙")+"]你去世了。\n如题。"],function(){core.events.gameOver(null,b)})})},changingFloor:function(d,f,e){var c=core.status.floorId||null;core.maps.resizeMap(d);if(!e){core.status.maps[d].blocks.forEach(function(h){if(h.disable&&core.enemys.hasSpecial(h.event.id,23)){h.disable=false}})}core.status.hero.loc=f;core.control.gatherFollowers();core.drawMap(d);if(core.status.maps[d].bgm){var a=core.status.maps[d].bgm;if(a instanceof Array){a=a[0]}core.playBgm(a)}var b=core.getFlag("__color__",null);if(!b&&core.status.maps[d].color){b=core.status.maps[d].color}core.clearMap("curtain");core.status.curtainColor=b;if(b){core.fillRect("curtain",0,0,core.__PIXELS__,core.__PIXELS__,core.arrayToRGBA(b))}var g=core.getFlag("__weather__",null);if(!g&&core.status.maps[d].weather){g=core.status.maps[d].weather}if(g){core.setWeather(g[0],g[1])}else{core.setWeather()}},afterChangeFloor:function(a,b){if(b){core.events.recoverEvents(core.getFlag("__events__"));core.removeFlag("__events__")}else{core.insertAction(core.floors[a].eachArrive);if(!core.hasVisitedFloor(a)){core.insertAction(core.floors[a].firstArrive);core.visitFloor(a)}}core.drawMap()},flyTo:function(e,a){var b=core.status.floorId;if(!core.status.maps[b].canFlyTo||!core.status.maps[e].canFlyTo){core.drawTip("无法飞往"+core.status.maps[e].title+"！");return false}var c=core.floorIds.indexOf(b),f=core.floorIds.indexOf(e);var d=c<=f?"downFloor":"upFloor";if(c==f&&core.status.maps[b].underGround){d="upFloor"}core.status.route.push("fly:"+e);core.ui.closePanel();core.changeFloor(e,d,null,null,a);return true},beforeBattle:function(f,m,n){if(m!=null&&n!=null){var j=m+","+n,b=core.status.checkBlock.cache[j]||{},g=b.guards||[];if(g.length>0){core.setFlag("__guards__"+m+"_"+n,g);var a=[];g.forEach(function(o){core.push(a,{type:"jump",from:[o[0],o[1]],to:[m,n],time:300,keep:false,async:true})});core.push(a,[{type:"waitAsync"},{type:"trigger",loc:[m,n]}]);core.insertAction(a);return false}}var h="";var i="hand";if(core.status.hero.lv>=10){i="attack2"}if(core.status.hero.lv>=19){i="attack3"}if(core.status.hero.lv>=24){i="attack4"}if(core.flags.enableSkill){var k=core.getFlag("skill",0);if(k==1){h="skill1"}else{if(k==2){h="skill2"}else{if(k==4){h="blood"}else{if(k==0){h=i}}}}}else{h=i}if(core.getFlag("morph",0)==1||core.getFlag("morph_chap3",0)){if(core.getFlag("skill",0)!=0){h="darkexplode"}else{h="morphattack"}}function d(o){core.drawAnimate(o!=null?o:h,m!=null?m:core.getHeroLoc("x"),n!=null?n:core.getHeroLoc("y"))}function c(o,p,q){if(o==null){d()}else{core.drawAnimate(o,p!=null?p:core.getHeroLoc("x"),q!=null?q:core.getHeroLoc("y"),d)}}var e=core.material.enemys[f];var l=e.special;if(f=="E572"||f=="E545"){c("sword4")}else{if(f=="E558"){c("sword5")}else{if(f=="E559"||f=="E560"||f=="E564"){c("fire")}else{if(f=="E561"||f=="E562"){c("thunder")}else{if(f=="darkKnight"){c("dark2")}else{if(f=="E543"){c("dark")}else{if(core.enemys.hasSpecial(l,143)){c("purify")}else{if(core.enemys.hasSpecial(l,132)){c("blackmagic")}else{if(core.enemys.hasSpecial(l,141)){c("thunder3")}else{if(core.enemys.hasSpecial(l,130)){c("sword1")}else{if(core.enemys.hasSpecial(l,19)){c("explosion")}else{if(core.enemys.hasSpecial(l,21)){c("tuihua")}else{if(core.enemys.hasSpecial(l,130)){c("sword2")}else{if(core.enemys.hasSpecial(l,131)){c("omnislash")}else{if(core.enemys.hasSpecial(l,128)){c("dark")}else{if(core.enemys.hasSpecial(l,9)){c("purify")}else{if(core.enemys.hasSpecial(l,11)){c("blood")}else{if(core.enemys.hasSpecial(l,12)){c("poison")}else{if(core.enemys.hasSpecial(l,13)){c("weak")}else{if(core.enemys.hasSpecial(l,14)||core.enemys.hasSpecial(l,109)){c("ice")}else{if(core.enemys.hasSpecial(l,103)){c("skill1")}else{if(core.enemys.hasSpecial(l,104)){c("sword3")}else{if(core.enemys.hasSpecial(l,108)){c("iceblast")}else{if(core.enemys.hasSpecial(l,110)){c("light")}else{if(core.enemys.hasSpecial(l,111)){c("dark")}else{if(core.enemys.hasSpecial(l,112)){c("xunjie")}else{if(core.enemys.hasSpecial(l,113)){c("xunjie",m,n)}else{if(core.enemys.hasSpecial(l,114)){c("xunjie",m,n)}else{if(core.enemys.hasSpecial(l,116)){c("xunjie")}else{if(core.enemys.hasSpecial(l,117)){c("heal",m,n)}else{if(core.enemys.hasSpecial(l,118)){c("darkattack",m,n)}else{if(core.enemys.hasSpecial(l,119)){c("light2")}else{if(core.enemys.hasSpecial(l,124)){c("explosion_small")}else{if(core.enemys.hasSpecial(l,126)){c("blood2")}else{c(null)}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}return true},afterBattle:function(i,u,v,b){var h=core.material.enemys[i];var f=core.enemys.getDamage(i,u,v);if(f==null){f=core.status.hero.hp+1}core.status.hero.hp-=f;if(core.status.hero.hp>core.getRealStatusOrDefault(core.status.hero,"hpmax")){core.insertAction({type:"animate",name:"heal",loc:"hero",async:true});core.setFlag("hp_score",core.getFlag("hp_score",0)+core.status.hero.hp-core.getRealStatusOrDefault(core.status.hero,"hpmax"));core.status.hero.hp=core.getRealStatusOrDefault(core.status.hero,"hpmax")}core.status.hero.statistics.battleDamage+=f;core.status.hero.statistics.battle++;if(core.status.hero.hp<=0){core.status.hero.hp=0;core.updateStatusBar();core.events.lose("战斗失败");return}var k=[];if(u!=null&&v!=null){core.removeBlock(u,v);k=core.getFlag("__guards__"+u+"_"+v,[]);core.removeFlag("__guards__"+u+"_"+v)}var o=k.reduce(function(w,x){return w+core.material.enemys[x[2]].money},h.money);if(core.hasItem("coin")){o*=2}if(core.hasFlag("curse")){o=0}core.status.hero.money+=o;core.status.hero.statistics.money+=o;var j=k.reduce(function(w,x){return w+core.material.enemys[x[2]].experience},h.experience);core.status.hero.experience+=j;core.status.hero.statistics.experience+=j;var l="打败 "+h.name;if(core.flags.enableMoney){l+="，金币+"+o}if(core.flags.enableExperience){l+="，经验+"+j}core.drawTip(l);var t=[];var r=h.special;if(core.enemys.hasSpecial(r,12)){core.setFlag("poison_stack",core.getFlag("poison_stack",0)+h.poison)}if(core.getFlag("weak_stack",0)){core.setFlag("weak_stack",core.getFlag("weak_stack")-1)}if(core.enemys.hasSpecial(r,13)){core.setFlag("weak_stack",core.getFlag("weak_stack",0)+h.weak)}var a=Math.pow(0.95,core.getFlag("weak_stack",0));core.setBuff("atk",a);core.setBuff("def",a);if(core.enemys.hasSpecial(r,14)){core.setFlag("curse_stack",core.getFlag("curse_stack",0)+h.n)}if(core.enemys.hasSpecial(r,108)){core.setFlag("curse_stack",0)}if(core.enemys.hasSpecial(r,110)){core.setFlag("dark",core.getFlag("dark",0)-h.n)}if(core.enemys.hasSpecial(r,111)){core.setFlag("dark",core.getFlag("dark",0)+h.n)}if(core.enemys.hasSpecial(r,119)){core.setFlag("dark",0)}if(core.enemys.hasSpecial(r,109)){var n=core.enemys.getDamageInfo(h,null,u,v).turn;core.setFlag("curse_stack",core.getFlag("curse_stack",0)+n)}if(core.flags.hatredDecrease&&core.enemys.hasSpecial(r,17)){core.setFlag("hatred",Math.floor(core.getFlag("hatred",0)/2))}if(core.getFlag("morph",0)==0){if(core.enemys.hasSpecial(r,124)){core.status.hero.hp=Math.floor(core.status.hero.hp/2)}if(core.enemys.hasSpecial(r,19)){core.status.hero.hp=1}}if(core.enemys.hasSpecial(r,21)){core.status.hero.atk-=(h.atkValue||0);core.status.hero.def-=(h.defValue||0);core.status.hero.mdef-=(h.value||0);if(core.status.hero.atk<0){core.status.hero.atk=0}if(core.status.hero.def<0){core.status.hero.def=0}}if(core.enemys.hasSpecial(r,133)){core.addFlag("bo_hp",(h.bo_hp||0));core.addFlag("bo_atk",(h.bo_atk||0));core.addFlag("bo_def",(h.bo_def||0))}core.setFlag("hatred",core.getFlag("hatred",0)+core.values.hatred);if(core.flags.enableSkill){var q=core.getFlag("skill",0);if(q==1){core.status.hero.mana-=core.getFlag("skill1_cost",0)}else{if(q==2){core.status.hero.mana-=core.getFlag("skill2_cost",0)}else{if(q==4){core.status.hero.mana-=core.getFlag("skill4_cost",0)}}}core.setFlag("skill",0);core.setFlag("skillName","无")}core.status.hero.mana+=core.getFlag("mana_regen",0);if(core.hasItem("I_charge")){core.setFlag("charge_atk",0)}else{if(core.hasItem("I_charge2")){var d=core.getFlag("charge2_battle_extra",0);if(d>0){var e=core.getFlag("charge2_battle_extra_cur",0);var s=core.getFlag("charge2_battle_extra_max",0);var m=Math.min(d,s-e);core.setFlag("charge2_battle_extra_cur",e+m);core.setFlag("charge_atk",core.getFlag("charge_atk")+core.status.hero.atk*core.getFlag("charge_ratio",0.02)*m)}}}core.updateStatusBar();if(core.getFlag("invisible",0)){core.setFlag("invisible",0);core.setOpacity("hero",1);if(core.getFlag("hard")!=1){core.setFlag("no_zone",0);core.setFlag("no_snipe",0);core.setFlag("no_betweenAttack",0);core.setFlag("no_laser",0);core.setFlag("no_ambush",0)}else{core.setFlag("no_snipe",0);core.setFlag("no_ambush",0)}core.drawMap()}var g=core.getFlag("morph_duration");if(g>0){g--;core.setFlag("morph_duration",g);if(g==0){core.insertAction([{type:"insert",loc:[12,1],floorId:"EventMap"}])}}var c=core.getFlag("morph_cooldown",0);if(c>0){c--;core.setFlag("morph_cooldown",c);if(c==0){core.playSound("Darkness3.ogg");core.drawTip("【魔化】准备就绪。");core.getItem("I_morph_cooldown",-1);core.getItem("I_morph",1)}}var p=core.material.enemys[i].point;if(core.flags.enableAddPoint&&p>0){core.push(t,[{type:"insert",name:"加点事件",args:[p]}])}core.push(t,core.floors[core.status.floorId].afterBattle[u+","+v]);if(t.length>0){core.insertAction(t,u,v)}if(core.status.event.id==null){core.continueAutomaticRoute()}else{core.clearContinueAutomaticRoute()}if(b){b()}},afterOpenDoor:function(b,e,f,a){var d=[];var c=core.floors[core.status.floorId].afterOpenDoor[e+","+f];if(c){core.unshift(d,c)}if(d.length>0){core.insertAction(d,e,f)}if(core.status.event.id==null){core.continueAutomaticRoute()}else{core.clearContinueAutomaticRoute()}if(a){a()}},afterGetItem:function(c,e,f,a){if(c=="I_ex_atk"){core.playSound("005-System05.ogg")}else{if(c=="I_ex_def"){}else{if(c=="I_morphed"||c=="I_morph"||c=="I_morph_cooldown"){}else{core.playSound("item.mp3")}}}var d=[];var b=core.floors[core.status.floorId].afterGetItem[e+","+f];if(b){core.unshift(d,b)}if(d.length>0){core.insertAction(d,e,f)}if(a){a()}},afterChangeLight:function(a,b){},afterPushBox:function(){if(core.searchBlock("box").length==0){}},afterUseBomb:function(){},canUseQuickShop:function(a){if(core.status.thisMap.canUseQuickShop===false){return"当前楼层不能使用快捷商店。"}return null}},enemys:{getSpecials:function(){return[[1,"先攻","先发制人。怪物首先攻击。"],[2,"魔攻","穿透护甲直接造成伤害。怪物无视勇士的防御。","#b6b0ff"],[3,"坚固","勇士每次普通攻击最多只能对怪物造成1点伤害。","#b9822d"],[4,"2连击","怪物每回合攻击2次"],[5,"3连击","怪物每回合攻击3次"],[6,function(a){return(a.n||4)+"连击"},function(a){if(a.n>10){return"【血海奥义】天下武功，唯快不破\n怪物每回合攻击18次"}return"怪物每回合攻击"+(a.n||4)+"次"}],[7,"破甲",function(a){return"侵蚀对手的护甲。首回合怪物攻击时，附加勇士防御的"+Math.floor(100*a.value||0)+"%作为伤害"},"#b30000"],[8,"反伤",function(a){return"来犯之敌，自讨苦吃。勇士攻击时，攻击力的"+Math.floor(100*a.value||0)+"%也会同时伤害到自身，此伤害无视防御。"},"#bd26ce"],[9,"净化","【红海技能】用对手的护盾反制对手\n战斗前，怪物附加勇士护盾数值的"+core.values.purify+"倍作为伤害","#00d2d4"],[10,"模仿","【红海技能】遇弱则弱，遇强则强\n怪物的攻防与勇士基础攻防相等。","#ff00d2"],[11,function(a){if(a.value>=1){return"吸爆"}return"吸血"},function(a){var b="【红海技能】据说一些蓝海生物也能够掌握\n";if(a.value>=1){b="【血海奥义】吸干对手的血液\n"}return b+"战斗开始时，怪物首先将角色的"+Math.floor(100*a.value||0)+"%当前生命（约"+Math.floor((a.value||0)*core.getStatus("hp"))+"点）作为伤害"+(a.add?"，并把伤害数值加到自身生命上":"")},"#ff00d2"],[12,"中毒",function(a){return"【红海技能】战斗后，勇士陷入中毒状态，在接下来的战斗中每回合损失生命"+a.poison+"点，效果可叠加。"},"#4aff60"],[13,"衰弱",function(a){return"【红海技能】战斗后，勇士获得"+a.weak+"层衰弱状态，每层使得战斗中攻防下降"+(core.values.weakValue>=1?core.values.weakValue+"点":parseInt(core.values.weakValue*100)+"%")+"。每次战斗减少1层。"},"#feccd0"],[14,"霜寒",function(a){return"怪物对敌人施加霜寒诅咒。战斗后，你获得"+a.n+"层霜寒状态，每层使你普通攻击造成的伤害降低1%，加法叠加。"},"#747dff"],[15,"领域",function(a){if(core.getFlag("hard",0)==1){return"此难度下该属性无效！"}return"经过怪物周围"+(a.zoneSquare?"九宫格":"十字")+"范围内"+(a.range||1)+"格时自动减生命"+(a.value||0)+"点"}],[16,"夹击",function(a){if(core.getFlag("hard",0)==1){return"此难度下该属性无效！"}return"【红海技能】瞬间将对手打个半死\n经过两只相同的怪物中间，勇士生命值变成一半。"},"#ff00d2"],[17,"仇恨","战斗前，怪物附加之前积累的仇恨值作为伤害"+(core.flags.hatredDecrease?"；战斗后，释放一半的仇恨值":"")+"。（每杀死一个怪物获得"+(core.values.hatred||0)+"点仇恨值）"],[18,"阻击",function(a){return"经过怪物的十字领域时自动减生命"+(a.value||0)+"点，同时怪物后退一格"}],[19,"自爆","【血海奥义】同归于尽吧！\n战斗结束后，勇士的生命值变成1","#ff0000"],[20,"无敌","【？？？】无法认知的神秘力量\n勇士无法打败怪物，除非拥有[？？？]","#fbff00"],[21,"退化",function(a){return"【血海奥义】对敌人造成永久性不可逆的能力损伤\n战斗后勇士永久下降"+(a.atkValue||0)+"点攻击，"+(a.defValue||0)+"点防御，以及"+(a.value||0)+"点护盾"},"#ff0000"],[22,"固伤",function(a){return"【红海技能】不讲道理的生命扣除\n战斗结束前，怪物对勇士造成"+(a.damage||0)+"点固定伤害，无视勇士护盾和减伤效果。"}],[23,"重生","怪物被击败后，角色转换楼层则怪物将再次出现"],[24,"射击",function(a){if(core.getFlag("hard",0)==1){return"此难度下该属性无效！"}return"经过怪物同行或同列时自动减生命"+(a.value||0)+"点"}],[25,function(a){if(a.value){return"活力光环"}if(a.atkValue){return"狂暴光环"}if(a.defValue){return"坚毅光环"}},function(a){var b="同地图所有怪物";if(a.value){b+="生命提升"+(a.value||0)+"%，"}if(a.atkValue){b+="攻击提升"+(a.atkValue||0)+"%，"}if(a.defValue){b+="防御提升"+(a.defValue||0)+"%，"}b+=(a.add?"线性叠加":"不可叠加");return b},"#fff900"],[26,"支援","当周围一圈的怪物受到攻击时将上前支援，并组成小队战斗。"],[27,"捕捉","此怪物十分好战。当走到怪物周围十字时会强制进行战斗。"],[99,"闪避",function(a){return"躲闪一部分攻击。受到的普通攻击伤害降低"+(a.defValue||0)+"%。"},"#c3c3c3"],[100,"穿刺",function(a){return"攻击能够穿透一部分防御。无视对手"+(a.x||0)+"%的防御力。"}],[101,"夹爆",function(a){if(core.getFlag("hard",0)==1&&core.hasItem("I_hp_score")){return"此难度下该属性无效！"}return"【血海奥义】瞬间将对手打得奄奄一息\n经过两只相同的怪物中间，勇士生命值变成1。"},"#ff0000"],[102,"上位威压",function(b){var a=(b.value||0)-core.status.hero.lv;if(a>=0){return"以上位者的气质震慑对手。双方等级较高者每比对手高出一级，便在先前基础上进一步削弱对手"+Math.floor(b.n)+"%的攻防，当前对方比你高"+a+"级"}else{return"被上位者的气质震慑。双方等级较高者每比对手高出一级，便在先前基础上进一步削弱对手"+Math.floor(b.n)+"%的攻防，当前你比对方高"+-a+"级"}},"#b113ff"],[103,"强击",function(a){return"一次强力的攻击。怪物首回合获得"+(a.atkValue||0)+"倍攻击力。"},"#b30000"],[104,"斩杀",function(a){return"一旦对手势弱，攻击就会更加致命。战斗中，若勇士生命值低于"+(a.range||0)+"%，则怪物攻击力提升"+(a.n||0)+"%。"}],[105,"重甲",function(a){return"无视对手"+(a.defValue||0)+"%的攻击力。"},"#b9822d"],[106,"寒霜之足",function(a){return"危险的寒冰咒印。怪物前5回合每回合额外造成"+a.damage+"点伤害，然后冰封对方10回合。"},"#b30000"],[107,"冰封禁制",function(a){return"将敌人锁在冰块之中。怪物首先冰封对方3回合，每回合额外造成"+a.damage+"点伤害。"},"#b30000"],[108,"霜寒爆发","令敌人体内的霜寒尽数爆发。战斗开始时，立即清除勇士的所有霜寒状态，每驱除1层就会使勇士冰封1回合。","#43e2dc"],[109,"寒冰护甲","冷气贯穿全身。每受到1回合攻击就会使勇士获得1层霜寒状态，战斗后生效。","#747dff"],[110,"光明",function(a){return"战斗后，勇士获得"+a.n+"层光明状态，每层使得勇士受到和造成的伤害均提升1%，线性叠加。会与黑暗状态相抵消。"},"#FFFFFF"],[111,"黑暗",function(a){return"战斗后，勇士获得"+a.n+"层黑暗状态，每层使得勇士受到和造成的伤害均减少1%，线性叠加。会与光明状态相抵消。"},"#737373"],[112,"迅捷","迅捷的反应令对手猝不及防。怪物先攻10次。","#55ff72"],[113,"迟钝","迟钝的反应令自己猝不及防。勇士先攻10次。","#e0d42d"],[114,"智障","智力有严重缺陷。勇士先攻100次。","#aba222"],[115,"怒意狂击",function(a){return"攻击越发致命。怪物每回合提升"+a.v_115+"点攻击力"},"#f39f00"],[116,"魔爪","黑暗的力量使对手动弹不得。怪物先攻100次。","#8500b1"],[117,"神圣愈合","持续引导神圣的治愈之力。不攻击，每回合治愈自身10000点生命值。","#ffffff"],[118,"暗影庇护","隐藏于暗影之中。处于无敌状态，但每回合损耗自身2%的最大生命值。","#666666"],[119,"驱邪","使对方体内的不洁之力尽数爆发。战斗开始时驱除勇士的所有光明/黑暗状态，每驱除1层便额外造成64100点伤害。","#fff900"],[120,"魔免","免疫技能伤害。","#c3c3c3"],[121,"重伤",function(a){return"造成难以治愈的严重伤害。使对手受到的回复效果降低"+(a.v_121||0)+"%。"},"#b30000"],[122,"盛宴",function(a){return"【红海技能】撕扯对手的血肉\n每次攻击造成对方最大生命值"+(a.v_122||0)+"%的额外伤害。"},"#ff00d2"],[123,"竭心",function(a){if(core.getFlag("hard",0)==1){return"此难度下该属性无效！"}return"【红海技能】心脏慢慢停止跳动\n经过怪物周围"+(a.zoneSquare?"九宫格":"十字")+"范围内"+(a.range||1)+"格时自动减最大生命的"+(a.value||0)+"%"},"#78b305"],[124,"血怨","【红海技能】死亡的怨念缠绕着对手。似乎是某个血海奥义的劣化版本\n战斗结束后，勇士的生命值变成一半。","#ff00d2"],[125,"血域",function(a){if(core.getFlag("hard",0)==1){return"此难度下该属性无效！"}return"【红海技能】生命在流逝\n经过怪物周围"+(a.zoneSquare?"九宫格":"十字")+"范围内"+(a.range||1)+"格时自动减当前生命的"+(a.value||0)+"%"},"#ff00d2"],[126,"苦痛",function(a){return"【红海技能】引诱对手走向死亡\n战斗开始时，造成对方已损失生命值"+a.v_126+"%的伤害。"},"#ff00d2"],[127,"死亡镰刀",function(a){return"【红海技能】似乎是某个血海奥义的劣化版本。第5回合结束时，造成相当于对方已损失生命值100%的伤害。"},"#78b305"],[128,"邪恶净化","【血海奥义】运用至邪之力打击对手\n战斗开始前，暂时移除对方的所有护盾，并造成100万额外伤害。","#b113ff"],[130,"审判之剑","【血海奥义】传说此招曾经粉碎过一位魔王的复仇计划\n剥夺对手拥有的剑盾，且如果对方拥有“魔王”称号，则使其攻防减半","#ff0000"],[131,"无敌斩","【血海奥义】以无敌的姿态爆发出暴雨般的斩击\n战前以2倍攻击力先攻9次","#ff0000"],[132,"混乱","颠倒对手的能力。战斗中，勇士攻防互换","#c3c3c3"],[133,"伯化",function(b){var c="【血海奥义】伯力之神的力量\n战斗后，所有拥有该属性的怪物提升";var a="";if(b.bo_hp){a+=b.bo_hp+"点生命，"}if(b.bo_atk){a+=b.bo_atk+"点攻击力，"}if(b.bo_def){a+=b.bo_def+"点防御力，"}if(a){a+="可叠加。";c+=a;return c}return"【血海奥义】伯力之神的力量\n此怪物享受伯化加成，但战斗后不会提供额外伯化效果。"},"#eda6ff"],[134,"域爆",function(a){if(core.getFlag("hard",0)==1){return"此难度下该属性无效！"}return"【血海奥义】领域之极致\n经过怪物周围"+(a.zoneSquare?"九宫格":"十字")+"范围内"+(a.range||1)+"格时生命变为1点"},"#ff0000"],[135,"阻爆","【血海奥义】阻击之极致\n经过怪物的十字领域时生命变为1点，同时怪物后退一格","#ff0000"],[136,"射爆",function(a){if(core.getFlag("hard",0)==1){return"此难度下该属性无效！"}return"【血海奥义】射击之极致\n经过怪物同行或同列时生命变为1点"},"#ff0000"],[137,"超越","【血海奥义】遇弱则强，遇强则更强\n怪物的攻防是勇士基础攻防的1.2倍。","#4340ff"],[138,function(a){if(a.defValue>0){return"坚韧光环"}return"软弱光环"},function(a){var b=a.range*2+1;return(a.defValue>0?"增加":"减少")+"以自身为中心"+b+"*"+b+"范围内所有友军"+(Math.abs(a.defValue)||0)+"%的防御力，线性叠加。"},"#fff900"],[139,function(a){if(a.value>0){return"活力光环"}return"抑郁光环"},function(a){var b=a.range*2+1;return(a.value>0?"增加":"减少")+"以自身为中心"+b+"*"+b+"范围内所有友军"+(Math.abs(a.value)||0)+"%的生命，线性叠加。"},"#fff900"],[140,function(a){if(a.atkValue>0){return"狂暴光环"}return"衰退光环"},function(a){var b=a.range*2+1;return(a.atkValue>0?"增加":"减少")+"以自身为中心"+b+"*"+b+"范围内所有友军"+(Math.abs(a.atkValue)||0)+"%的攻击力，线性叠加。"},"#fff900"],[141,"中子束","【血海奥义】简单粗暴而威力巨大的攻击\n怪物每回合普攻2次，魔攻1次。","#e47400"],[142,"法力虚空","【血海奥义】敌人将因使用魔法而遭到惩戒\n瞬间造成对手最大生命值X%的伤害，X为已损失魔法的比例","#747dff"],[143,"净爆","【血海奥义】净化之极致\n战斗前，怪物使勇士护盾变为100倍，然后附加此时勇士护盾数值的"+core.values.purify+"倍作为伤害","#00d2d4"],[144,"崩甲","【血海奥义】相比净化爆发力较弱，但更加持久\n怪物每回合附加勇士战斗开始时的护盾数值的0.1倍作为伤害","#00d2d4"],]},getEnemyInfo:function(e,h,w,z,f){f=f||core.status.floorId;var k=core.getRealStatusOrDefault(h,"hp"),i=core.getRealStatusOrDefault(h,"atk"),j=core.getRealStatusOrDefault(h,"def"),l=core.getRealStatusOrDefault(h,"mdef");var r=e.hp,o=e.atk,p=e.def,u=e.special;var s=e.money,q=e.experience,t=e.point;if(core.hasSpecial(u,133)){r+=core.getFlag("bo_hp",0);o+=core.getFlag("bo_atk",0);p+=core.getFlag("bo_def",0)}if(core.hasSpecial(u,10)){o=i;p=j}if(core.hasSpecial(u,137)){o=1.2*i;p=1.2*j}var g=[];var v=function(){var x=["MT70","MT78","MT79","MT7A","MT80","MT87","MT88","MT89","MT90","Chap3_boss","MT100","MT102","MT103","MT104","MT105","MT106","MT108","MT109","MT110","MT111","MT113","MT114","MT115","MT116","MT118","MT119","MT120","Final"];return core.inArray(x,f)};if(v()){var m=0,a=0,d=0,c=0;var n=w!=null&&z!=null?(w+","+z):"floor";if(!core.status.checkBlock){core.status.checkBlock={}}if(!core.status.checkBlock.cache){core.status.checkBlock.cache={}}var b=core.status.checkBlock.cache[n];if(!b){core.status.maps[f].blocks.forEach(function(x){if(!x.disable){var A=x.event.id,y=core.material.enemys[A];if(y&&core.hasSpecial(y.special,25)){if(y.add||c==0){m+=y.value||0;a+=y.atkValue||0;d+=y.defValue||0;c++}}if(core.isset(y)&&core.hasSpecial(y.special,140)&&core.isset(w)&&core.isset(z)&&Math.abs(x.x-w)<=y.range&&Math.abs(x.y-z)<=y.range){a+=y.atkValue||0;c++}if(core.isset(y)&&core.hasSpecial(y.special,138)&&core.isset(w)&&core.isset(z)&&Math.abs(x.x-w)<=y.range&&Math.abs(x.y-z)<=y.range){d+=y.defValue||0;c++}if(core.isset(y)&&core.hasSpecial(y.special,139)&&core.isset(w)&&core.isset(z)&&Math.abs(x.x-w)<=y.range&&Math.abs(x.y-z)<=y.range){m+=y.value||0;c++}if(y&&core.hasSpecial(y.special,26)&&w!=null&&z!=null&&Math.abs(x.x-w)<=1&&Math.abs(x.y-z)<=1&&!(w==x.x&&z==x.y)){g.push([x.x,x.y,A])}}});core.status.checkBlock.cache[n]={hp_buff:m,atk_buff:a,def_buff:d,guards:g}}else{m=b.hp_buff;a=b.atk_buff;d=b.def_buff;g=b.guards}r*=(1+m/100);o*=(1+a/100);p*=(1+d/100)}return{hp:Math.floor(r),atk:Math.floor(o),def:Math.floor(p),money:Math.floor(s),experience:Math.floor(q),point:Math.floor(t),special:u,guards:g,}},getDamageInfo:function(j,u,aa,ab,m){m=m||core.status.floorId;var z=core.getRealStatusOrDefault(u,"hp"),v=core.getRealStatusOrDefault(u,"atk"),w=core.getRealStatusOrDefault(u,"def"),D=core.getRealStatusOrDefault(u,"mdef"),S=z,Q=v,R=w;var B=core.getRealStatusOrDefault(core.status.hero,"hpmax");var C=core.status.hero.lv;v+=core.getFlag("greenAtk",0);w+=core.getFlag("greenDef",0);z=Math.max(0,z);v=Math.max(0,v);w=Math.max(0,w);D=Math.max(0,D);var e=core.getFlag("dark",0);var h=1-0.01*e;var k=core.enemys.getEnemyInfo(j,u,aa,ab,m);var O=k.hp,L=k.atk,N=k.def,P=k.special;if(core.hasSpecial(P,102)){var K=(j.value||0)-C;if(K>=0){v*=Math.pow((1-j.n/100),K);w*=Math.pow((1-j.n/100),K)}else{L*=Math.pow((1-j.n/100),-K);N*=Math.pow((1-j.n/100),-K)}}if(core.getFlag("skill",0)==2){var f=core.getFlag("skill2_atk_ratio",0)*v;var H=f*core.getFlag("skill2_def_ratio");v-=f;w+=H}if(core.hasSpecial(P,132)){var X=w;w=v;v=X}if(core.hasSpecial(P,100)){w*=(1-(j.x/100))}if(core.hasSpecial(P,105)){v*=(1-(j.defValue/100))}if(core.getFlag("skill",0)==1){var l=(core.getFlag("skill1_val",2)-1)*v;if(core.hasSpecial(P,120)){l=0}l*=h;O-=l}if(core.hasSpecial(P,20)&&!core.hasItem("cross")){return null}var J=0;if(core.hasSpecial(P,119)){h=1;J+=64100*Math.abs(e)}if(core.hasSpecial(P,11)){var Z=z*j.value;if(core.getFlag("morph",0)){Z=0}Z=Math.floor(Z)||0;if(j.add){O+=Z}J+=Z}if(core.hasSpecial(P,126)&&!core.getFlag("morph",0)){J+=j.v_126/100*(B-z)}if(core.hasSpecial(P,128)){D=0;J+=1000000}if(core.hasSpecial(P,131)){J+=(L*2-w)*9}if(core.hasSpecial(P,142)){J+=B*(1-core.status.hero.mana/core.status.hero.manamax)}var T=L-w;if(core.hasSpecial(P,122)){T+=B*j.v_122/100}if(core.hasSpecial(P,2)){T=L}if(T<0){T=0}if(core.hasSpecial(P,4)){T*=2}if(core.hasSpecial(P,5)){T*=3}if(core.hasSpecial(P,6)){T*=(j.n||4)}if(core.hasSpecial(P,141)){T*=2;T+=L}if(core.hasSpecial(P,144)){T+=D*0.1}var a=0;if(core.hasSpecial(P,8)){a+=Math.floor(j.value*v)}if(core.hasSpecial(P,1)){J+=T}if(core.hasSpecial(P,112)){J+=10*T}if(core.hasSpecial(P,116)){J+=100*T}if(core.hasSpecial(P,9)){J+=Math.floor(core.values.purify*D)}if(core.hasSpecial(P,143)){J+=Math.floor(core.values.purify*D*100-D*99)}var E=Math.max(v-N,0);E*=h;var c=core.getFlag("curse_stack",0);if(core.hasSpecial(P,108)){J+=c*T;c=0}c=core.getFlag("curse_stack",0);if(c>0){E*=(1-0.01*c)}if(core.hasSpecial(P,99)){E*=(1-(j.defValue/100))}if(core.hasSpecial(P,3)){E=Math.min(E,1)}if(core.hasSpecial(P,113)){O-=10*E}if(core.hasSpecial(P,114)){O-=100*E}if(core.hasSpecial(P,117)){if(O>E){E-=10000}}if(E<=0&&O>0){return null}var Y=Math.ceil(O/E);if(core.hasItem("execute")){var U=core.getFlag("execute_percentage",20);var G=core.getFlag("execute_atk_percentage",30);var b=O;if(b/E>1641){}else{Y=0;while(b>0){b-=E;if(b/O<U/100){b-=G/100*E}Y++}}}if(core.getFlag("skill",0)==4&&!core.hasSpecial(P,120)){var b=O;var o=core.getFlag("skill4_val",5)/100;Y=0;while(b>0){b*=(1-o);b-=E;if(core.hasItem("execute")){var U=core.getFlag("execute_percentage",20);var G=core.getFlag("execute_atk_percentage",30);if(b/O<U/100){b-=G/100*E}}Y++}}if(Y<1){Y=1}if(core.hasSpecial(P,7)&&Y>1){J+=Math.floor(j.value*w)}if(core.hasSpecial(P,103)&&Y>1){J+=j.atkValue*L-w;J-=Math.max(T,0)}if(core.hasSpecial(P,106)){J+=j.damage*(Math.min(Y,6)-1);if(Y>5){J+=10*T}}if(core.hasSpecial(P,107)){J+=3*j.damage;J+=3*T}if(core.hasSpecial(P,118)){Y=51}var q=core.getFlag("__guards__"+aa+"_"+ab,k.guards);var p=false;Y+=core.getFlag("__extraTurn__",0);if(q.length>0){if(!p){core.setFlag("__extraTurn__",Y)}for(var F=0;F<q.length;F++){var r=q[F][0],s=q[F][1],n=q[F][2];var I=core.enemys.getDamageInfo(core.material.enemys[n],{hp:S,atk:Q,def:R,mdef:0});if(I==null){return null}core.setFlag("__extraTurn__",I.turn);J+=I.damage}if(p){Y+=core.getFlag("__extraTurn__",0)}}core.removeFlag("__extraTurn__");var d=J+(Y-1)*T+Y*a;var V=core.getFlag("poison_stack",0);d+=V*Y;if(core.hasSpecial(P,115)&&Y>1){if(L-w>0){var W=Y-1;d+=W*(W+1)/2*j.v_115}else{var g=L-w;for(var ac=0;ac<Y-1;ac++){g+=j.v_115;d+=Math.max(g,0)}}}var t=1;if(core.hasSpecial(P,121)){t-=j.v_121/100}if(core.hasSpecial(P,104)&&Y>1){var b=z+D-J;var M=O;var V=core.getFlag("poison_stack",0);for(var F=1;F<=Y-1;F++){if(core.hasItem("I_vampire")){if(core.getFlag("skill",0)==1&&F==1&&!core.hasSpecial(P,120)){var l=(core.getFlag("skill1_val",3)-1)*v;b+=core.getFlag("vampire_ratio",0.2)*l*t}else{if(core.getFlag("skill",0)==4&&!core.hasSpecial(P,120)){var l=M*core.getFlag("skill4_val",5)/100;b+=core.getFlag("vampire_ratio",0.2)*l*t;M-=l;M-=E}}b+=core.getFlag("vampire_ratio",0.2)*E*t}var A=b/B;if(A<(j.range/100)){if(T>0){l=(j.n/100)*L}else{l=(1+(j.n/100))*L-w}d+=l}else{l=0}b-=T+l+V}}if(core.hasSpecial(P,127)&&Y>5){var b=z+D-J;var M=O;var V=core.getFlag("poison_stack",0);for(var F=1;F<=5;F++){if(core.hasItem("I_vampire")){if(core.getFlag("skill",0)==1&&F==1&&!core.hasSpecial(P,120)){var l=(core.getFlag("skill1_val",3)-1)*v;b+=core.getFlag("vampire_ratio",0.2)*l}else{if(core.getFlag("skill",0)==4&&!core.hasSpecial(P,120)){var l=M*core.getFlag("skill4_val",5)/100;b+=core.getFlag("vampire_ratio",0.2)*l;M-=l;M-=E}}b+=core.getFlag("vampire_ratio",0.2)*E}b-=T+V}d+=B-b}d*=h;d-=D*core.getFlag("mdef_ratio",1);d=Math.max(0,d);if(core.hasItem("I_vampire")){if(core.hasSpecial(P,118)){}else{d-=Math.floor(k.hp*core.getFlag("vampire_ratio",0.2))*t;if(core.hasSpecial(P,117)){d-=10000*core.getFlag("vampire_ratio",0.2)*Y*t}}}if(d>0){if(core.hasItem("I_hard_1")){d/=2}else{if(core.hasItem("I_hard_2")){d*=0.75}}}return{mon_hp:Math.floor(O),mon_atk:Math.floor(L),mon_def:Math.floor(N),init_damage:Math.floor(J),per_damage:Math.floor(T),hero_per_damage:Math.floor(E),turn:Math.floor(Y),damage:Math.floor(d)}},updateEnemys:function(){}},actions:{onKeyUp:function(b,a){if(core.isMoving()){return}if(a&&b>=48&&b<=57){core.items.quickLoadEquip(b-48);return}switch(b){case 27:core.openSettings(true);break;case 88:core.openBook(true);break;case 71:core.useFly(true);break;case 65:core.doSL("autoSave","load");break;case 83:core.save(true);break;case 68:core.load(true);break;case 69:core.ui.drawCursor();break;case 84:core.openToolbox(true);break;case 81:core.openEquipbox(true);break;case 90:core.turnHero();break;case 75:case 86:core.openQuickShop(true);break;case 32:core.getNextItem();break;case 82:core.actions._clickSyncSave_replay();break;case 33:case 34:core.ui.drawMaps();break;case 77:core.ui.drawPaint();break;case 66:core.ui.drawStatistics();break;case 72:core.ui.drawHelp();break;case 78:core.confirmRestart();break;case 79:core.actions._clickGameInfo_openProject();break;case 80:core.actions._clickGameInfo_openComments();break;case 49:if(core.hasItem("bring_hp")&&core.canUseItem("bring_hp")){core.status.route.push("key:49");core.useItem("bring_hp",true)}else{if(core.hasItem("pickaxe")&&core.canUseItem("pickaxe")){core.status.route.push("key:49");core.useItem("pickaxe",true)}}break;case 55:core.getNextItem();break;case 118:core.debug();break;case 50:if(core.hasItem("skill1")){core.status.route.push("key:50");core.useItem("skill1",true)}break;case 51:if(core.hasItem("skill2")){core.status.route.push("key:51");core.useItem("skill2",true)}break;case 52:if(core.hasItem("skill3")){core.status.route.push("key:52");core.useItem("skill3",true)}else{if(core.hasItem("skill4")){core.status.route.push("key:52");core.useItem("skill4",true)}}break;case 53:if(core.hasItem("I_morph")){core.status.route.push("key:53");core.useItem("I_morph",true)}break;case 87:if(core.hasItem("smallJump")){core.status.route.push("key:87");core.useItem("smallJump",true)}break;case 56:if(core.hasItem("bring_mana")){core.status.route.push("key:56");core.useItem("bring_mana",true)}break}}},control:{saveData:function(){var c=core.clone(core.status.hero),b=core.utils.hashCode(c);var f={};for(var d in core.values){if(!core.same(core.values[d],core.data.values[d])){f[d]=core.clone(core.values[d])}}var a={floorId:core.status.floorId,hero:c,hard:core.status.hard,maps:core.maps.saveMap(),route:core.encodeRoute(core.status.route),values:f,shops:{},version:core.firstData.version,time:new Date().getTime(),hashCode:b};for(var e in core.status.shops){a.shops[e]={times:core.status.shops[e].times||0,visited:core.status.shops[e].visited||false}}return a},loadData:function(b,a){core.resetGame(b.hero,b.hard,b.floorId,core.maps.loadMap(b.maps),b.values);core.status.route=core.decodeRoute(b.route);for(var d in core.status.shops){if(b.shops[d]){core.status.shops[d].times=b.shops[d].times;core.status.shops[d].visited=b.shops[d].visited}}core.status.textAttribute=core.getFlag("textAttribute",core.status.textAttribute);var e=core.getFlag("globalAttribute",core.status.globalAttribute);if(!core.same(e,core.status.globalAttribute)){core.status.globalAttribute=e;core.updateGlobalAttribute()}core.events.setVolume(core.getFlag("__volume__",1),0);var c=core.getFlag("heroIcon","hero.png");c=core.getMappedName(c);if(core.material.images.images[c]){core.material.images.hero=core.material.images.images[c];core.material.icons.hero.width=core.material.images.images[c].width/4;core.material.icons.hero.height=core.material.images.images[c].height/4}core.updateEnemys();if(core.getFlag("invisible",0)==1){core.setOpacity("hero",0.5)}else{core.setOpacity("hero",1)}core.setFlag("lastTime",0);core.setFlag("lastWeatherTime",0);core.changeFloor(b.floorId,null,b.hero.loc,0,function(){if(a){a()}},true)},updateStatusBar:function(){core.events.checkLvUp();if(core.flags.enableHPMax&&core.getStatus("hpmax")>=0){core.setStatus("hp",Math.min(core.getStatus("hpmax"),core.getStatus("hp")))}if(core.status.floorId){core.setStatusBarInnerHTML("floor",core.status.maps[core.status.floorId].name)}core.setStatusBarInnerHTML("name",core.getStatus("name"));core.setStatusBarInnerHTML("lv",core.getLvName());var d=["hpmax","hp","mana","atk","def","mdef","money","experience"];d.forEach(function(f){core.status.hero[f]=Math.floor(core.status.hero[f]);core.setStatusBarInnerHTML(f,core.getRealStatus(f));if(f=="atk"){var e=0;if(core.hasItem("I_ex_atk")){e+=core.getFlag("lastAtk",0)*0.1}if(core.hasItem("I_charge")||core.hasItem("I_charge2")){e+=core.getFlag("charge_atk",0)}e=Math.floor(e);core.setFlag("greenAtk",e);var g=core.getRealStatus(f)+e;core.setStatusBarInnerHTML(f,core.formatBigNumber(g))}else{if(f=="def"&&core.hasItem("I_ex_def")){core.setStatusBarInnerHTML(f,core.formatBigNumber(core.getRealStatus(f))+'<font color="#00FF00">+'+String(Math.floor(core.getFlag("lastDef",0)*0.2))+"</font>")}}});if(core.flags.enableMana){if(core.status.hero.manamax!=null&&core.status.hero.manamax>=0){core.status.hero.mana=Math.min(core.status.hero.mana,core.status.hero.manamax);core.setStatusBarInnerHTML("mana",core.status.hero.mana+"/"+core.status.hero.manamax)}else{core.setStatusBarInnerHTML("mana",core.status.hero.mana)}}if(core.flags.enableSkill){core.setStatusBarInnerHTML("skill",core.getFlag("skillName","无"))}if(core.flags.enableLevelUp&&core.status.hero.lv<core.firstData.levelUp.length){var c=core.calValue(core.firstData.levelUp[core.status.hero.lv].need);if(core.flags.levelUpLeftMode){core.setStatusBarInnerHTML("up",core.formatBigNumber(c-core.getStatus("experience"))||"")}else{core.setStatusBarInnerHTML("up",core.formatBigNumber(c)||"")}}else{core.setStatusBarInnerHTML("up","")}var b=["yellowKey","blueKey","redKey"];b.forEach(function(e){core.setStatusBarInnerHTML(e,core.setTwoDigits(core.itemCount(e)))});if(core.flags.enableDebuff){if(core.getFlag("poison_stack",0)){core.setStatusBarInnerHTML("poison","毒 "+core.getFlag("poison_stack",0))}else{var a=core.getFlag("dark",0);if(a>0){core.setStatusBarInnerHTML("poison","暗 "+a,"color: black")}else{if(a<0){core.setStatusBarInnerHTML("poison","光 "+(-a),"color: white")}else{core.setStatusBarInnerHTML("poison","")}}}if(core.getFlag("weak_stack",0)>0){core.setStatusBarInnerHTML("weak","衰 "+core.getFlag("weak_stack",0))}else{core.setStatusBarInnerHTML("weak","")}core.setStatusBarInnerHTML("curse",core.getFlag("curse_stack",0)>0?"寒 "+core.getFlag("curse_stack",0):"","color: #6C87FF")}if(core.flags.enablePZF){core.setStatusBarInnerHTML("pickaxe","破"+core.itemCount("pickaxe"));core.setStatusBarInnerHTML("bomb","炸"+core.itemCount("bomb"));core.setStatusBarInnerHTML("fly","飞"+core.itemCount("centerFly"))}core.statusBar.hard.innerHTML=core.status.hard;core.drawStatusBar();core.updateCheckBlock();core.updateDamage()},updateCheckBlock:function(m){m=m||core.status.floorId;if(!m||!core.status.maps){return}var F=core.floors[m].width,n=core.floors[m].height;var c=core.getMapBlocksObj(m);var f={},D={},B={},a={};for(var r in c){var b=c[r],G=b.x,H=b.y,o=b.event.id,j=core.material.enemys[o];if(o=="lavaNet"&&b.event.trigger=="passNet"&&!core.hasItem("shoes")){f[r]=(f[r]||0)+core.values.lavaDamage;D[r]="血网伤害"}if(j&&!core.hasFlag("no_zone")&&(core.hasSpecial(j.special,15)||core.hasSpecial(j.special,123)||core.hasSpecial(j.special,125)||core.hasSpecial(j.special,134))){var u=j.range||1;var I=false;if(j.zoneSquare!=null){I=j.zoneSquare}for(var h=-u;h<=u;h++){for(var i=-u;i<=u;i++){if(h==0&&i==0){continue}var s=G+h,t=H+i,e=s+","+t;if(s<0||s>=F||t<0||t>=n){continue}if(!I&&Math.abs(h)+Math.abs(i)>u){continue}if(core.hasSpecial(j.special,15)){f[e]=(f[e]||0)+(j.value||0)}else{if(core.hasSpecial(j.special,123)){f[e]=(f[e]||0)+Math.floor(core.getRealStatusOrDefault(core.status.hero,"hpmax")*j.value/100||0)}else{if(core.hasSpecial(j.special,125)){f[e]=(f[e]||0)+Math.floor(core.status.hero.hp*j.value/100||0)}else{if(core.hasSpecial(j.special,134)){f[e]=Math.max((f[e]||0),core.status.hero.hp-1)}}}}D[e]="领域伤害"}}}if(j&&!core.hasFlag("no_snipe")&&(core.hasSpecial(j.special,18)||core.hasSpecial(j.special,135))){for(var g in core.utils.scan){var s=G+core.utils.scan[g].x,t=H+core.utils.scan[g].y,e=s+","+t;if(s<0||s>=F||t<0||t>=n){continue}if(core.hasSpecial(j.special,18)){f[e]=(f[e]||0)+(j.value||0)}else{if(core.hasSpecial(j.special,135)){f[e]=Math.max((f[e]||0),core.status.hero.hp-1)}}D[e]="阻击伤害";var v=core.reverseDirection(g);var z=G+core.utils.scan[v].x,A=H+core.utils.scan[v].y;if(z>=0&&z<F&&A>=0&&A<n&&core.getBlock(z,A,m)==null){B[e]=(B[e]||[]).concat([[G,H,o,v]])}}}if(j&&!core.hasFlag("no_laser")&&(core.hasSpecial(j.special,24)||core.hasSpecial(j.special,136))){for(var s=0;s<F;s++){var e=s+","+H;if(s!=G){if(core.hasSpecial(j.special,24)){f[e]=(f[e]||0)+(j.value||0)}else{if(core.hasSpecial(j.special,136)){f[e]=Math.max((f[e]||0),core.status.hero.hp-1)}}D[e]="激光伤害"}}for(var t=0;t<n;t++){var e=G+","+t;if(t!=H){if(core.hasSpecial(j.special,24)){f[e]=(f[e]||0)+(j.value||0)}else{if(core.hasSpecial(j.special,136)){f[e]=Math.max((f[e]||0),core.status.hero.hp-1)}}D[e]="激光伤害"}}}if(j&&core.enemys.hasSpecial(j.special,27)&&!core.hasFlag("no_ambush")){for(var g in core.utils.scan){var s=G+core.utils.scan[g].x,t=H+core.utils.scan[g].y,e=s+","+t;if(s<0||s>=F||t<0||t>=n){continue}a[e]=(a[e]||[]).concat([[G,H,o,g]])}}}if(!core.hasFlag("no_betweenAttack")){for(var G=0;G<F;G++){for(var H=0;H<n;H++){var r=G+","+H;var D=0;var l=null;var p=c[(G-1)+","+H],w=c[(G+1)+","+H];if(p&&w&&p.id==w.id){if(core.hasSpecial(p.event.id,16)){l=p.event.id;D=0}else{if(core.hasSpecial(p.event.id,101)){l=p.event.id;D=1}}}var C=c[G+","+(H-1)],d=c[G+","+(H+1)];if(C&&d&&C.id==d.id){if(core.hasSpecial(C.event.id,16)){l=C.event.id;D=0}else{if(core.hasSpecial(C.event.id,101)){l=C.event.id;D=1}}}if(l!=null){f[r]=f[r]||0;var q=core.status.hero.hp-f[r];if(q>1){if(D==1){f[r]=Math.max(f[r],core.status.hero.hp-1)}else{var E=Math.floor((q+(core.flags.betweenAttackCeil?1:0))/2);if(core.flags.betweenAttackMax){var k=core.getDamage(l,G,H,m);if(k!=null&&k<E){E=k}}f[r]+=E}D[r]="夹击伤害"}}}}}core.status.checkBlock={damage:f,type:D,snipe:B,ambush:a,cache:{}}},moveOneStep:function(f,g){if(core.hasItem("I_charge")){var b=core.getFlag("charge_point",5);var e=core.getFlag("last_direction",null);var d=core.status.hero.loc.direction;if(e!=d){core.setFlag("charge_atk",0)}var a=core.getFlag("charge_atk",0);core.setFlag("charge_atk",a+b);core.setFlag("last_direction",d)}else{if(core.hasItem("I_charge2")){var c=core.getFlag("charge_ratio",0.02);var e=core.getFlag("last_direction",null);var d=core.status.hero.loc.direction;if(e!=d){core.setFlag("charge_atk",0);core.setFlag("charge2_battle_extra_cur",0)}var a=core.getFlag("charge_atk",0);core.setFlag("charge_atk",a+c*core.status.hero.atk);core.setFlag("last_direction",d)}}core.setHeroLoc("x",f,true);core.setHeroLoc("y",g,true);core.status.hero.steps++;core.updateFollowers();core.drawHero();if(core.hasFlag("poison")){core.status.hero.statistics.poisonDamage+=core.values.poisonDamage;core.status.hero.hp-=core.values.poisonDamage;if(core.status.hero.hp<=0){core.status.hero.hp=0;core.updateStatusBar();core.events.lose();return}}core.updateStatusBar()},moveDirectly:function(c,d){var a=core.canMoveDirectly(c,d);if(a>=0){core.clearMap("hero");var b=core.status.route[core.status.route.length-1];if(["left","right","up","down"].indexOf(b)>=0){core.setHeroLoc("direction",b)}core.setHeroLoc("x",c);core.setHeroLoc("y",d);core.drawHero();core.status.route.push("move:"+c+":"+d);core.status.hero.statistics.moveDirectly++;core.status.hero.statistics.ignoreSteps+=a;core.setFlag("charge_atk",0);core.setFlag("charge2_battle_extra_cur",0);core.updateStatusBar();return true}return false},parallelDo:function(timestamp){if(!core.isPlaying()){return}if(core.status.floorId){try{eval(core.floors[core.status.floorId].parallelDo)}catch(e){main.log(e)}}}},ui:{drawStatusBar:function(){if(!core.flags.statusCanvas){return}var a=core.dom.statusCanvas,b=core.dom.statusCanvasCtx;b.clearRect(0,0,a.width,a.height);if(!core.domStyle.showStatusBar){return}b.fillStyle=core.status.globalAttribute.statusBarColor||core.initStatus.globalAttribute.statusBarColor;b.font="italic bold 18px Verdana";var d=6,i=9,e=39;if(core.domStyle.isVertical){d=6;i=6;e=32}var h=["floor","hp","atk","def","mdef","money"];for(var c=0;c<h.length;c++){var f=h[c];b.drawImage(core.statusBar.icons[f],d,i,25,25);var g=(core.statusBar[f]||{}).innerText||" ";if(!/^[-a-zA-Z0-9`~!@#$%^&*()_=+\[{\]}\\|;:'",<.>\/?]*$/.test(g)){b.font="bold 18px Verdana"}b.fillText(g,d+36,i+20);b.font="italic bold 18px Verdana";if(core.domStyle.isVertical){if(c%3!=2){d+=131}else{d=6;i+=e}}else{i+=e}}b.fillStyle="#FFCCAA";b.fillText(core.statusBar.yellowKey.innerText,d+5,i+20);b.fillStyle="#AAAADD";b.fillText(core.statusBar.blueKey.innerText,d+40,i+20);b.fillStyle="#FF8888";b.fillText(core.statusBar.redKey.innerText,d+75,i+20)},drawStatistics:function(){return["yellowDoor","blueDoor","redDoor","greenDoor","steelDoor","yellowKey","blueKey","redKey","greenKey","steelKey","redJewel","blueJewel","greenJewel","yellowJewel","I349","I350","I351","I352","I353","I354","I355","I356","I357","I358","I359","I360","redPotion","bluePotion","yellowPotion","greenPotion","superPotion","I454","I455","I456","I457",]},drawAbout:function(){core.ui.closePanel();core.lockControl();core.status.event.id="about";var c=48,f=36,d=core.__PIXELS__-2*c,a=core.__PIXELS__-2*f;core.setAlpha("ui",0.85);core.fillRect("ui",c,f,d,a,"#000000");core.setAlpha("ui",1);core.strokeRect("ui",c-1,f-1,d+1,a+1,"#FFFFFF",2);var e=c+24;core.setTextAlign("ui","left");var b=(core.status.globalAttribute||core.initStatus.globalAttribute).font;core.fillText("ui","HTML5 魔塔样板",e,f+35,"#FFD700","bold 22px "+b);core.fillText("ui","版本： "+main.__VERSION__,e,f+80,"#FFFFFF","bold 17px "+b);core.fillText("ui","作者： 艾之葵",e,f+112);core.fillText("ui","HTML5魔塔交流群：539113091",e,f+112+32)}}};