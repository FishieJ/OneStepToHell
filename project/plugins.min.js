var plugins_bb40132b_638b_4a9f_b028_d3fe47acc8d1={init:function(){this._afterLoadResources=function(){};core.utils.setStatusBarInnerHTML=function(d,f,a){if(!core.statusBar[d]){return}if(typeof f=="number"){f=this.formatBigNumber(f)}var b=/^[-a-zA-Z0-9`~!@#$%^&*()_=+\[{\]}\\|;:'",<.>\/?]*$/.test(f);var e="font-style: "+(b?"italic":"normal")+"; ";var c=this.strlen(f)||1;e+="font-size: "+Math.min(1,7/c)+"em; ";if(d=="lv"){e+='font-family: "黑体";';if(f=="萌新五段"||f=="萌新六段"||f=="萌新七段"){e+="color: #56dc56;"}else{if(f=="萌新八段"||f=="萌新九段"||f=="蓝海一阶"||f=="蓝海二阶"){e+="color: #6b68ff;"}else{if(f=="蓝海三阶"||f=="蓝海四阶"||f=="蓝海五阶"||f=="蓝海六阶"||f=="蓝海七阶"||f=="蓝海八阶"||f=="蓝海九阶"||f=="蓝海巅峰"){e+="color: #b343e2;"}else{if(f=="红海低阶"||f=="红海中阶"||f=="红海高阶"||f=="红海巅峰"||f=="半步血海"){e+="color: #ff8be0;"}else{if(f=="血海初成"||f=="血海大成"||f=="血海圆满"){e+="color: #ff4040;"}}}}}}if(a){e+=a}core.statusBar[d].innerHTML="<span class='_status' style='"+e+"'>"+f+"</span>"};core.control.checkBlock=function(){var c=core.getHeroLoc("x"),d=core.getHeroLoc("y"),b=c+","+d;var a=core.status.checkBlock.damage[b];if(a){core.status.hero.hp-=a;core.drawTip("受到"+(core.status.checkBlock.type[b]||"伤害")+a+"点");if(core.status.hero.hp==1){core.drawAnimate("explosion",c,d)}else{core.drawAnimate("zone",c,d)}this._checkBlock_disableQuickShop();core.status.hero.statistics.extraDamage+=a;if(core.status.hero.hp<=0){core.status.hero.hp=0;core.updateStatusBar();core.events.lose();return}}this._checkBlock_snipe(core.status.checkBlock.snipe[b]);this._checkBlock_ambush(core.status.checkBlock.ambush[b])};core.enemys._getCurrentEnemys_sort=function(a){return a.sort(function(c,d){if(c.damage==d.damage){return c.experience-d.experience}if(c.damage==null){return 1}if(d.damage==null){return -1}return c.damage-d.damage})}},drawLight:function(){this.drawLight=function(e,a,d,c){var b=core.getContextByName(e);if(b==null){if(typeof e=="string"){b=core.createCanvas(e,0,0,core.__PIXELS__,core.__PIXELS__,98)}else{return}}b.mozImageSmoothingEnabled=false;b.webkitImageSmoothingEnabled=false;b.msImageSmoothingEnabled=false;b.imageSmoothingEnabled=false;core.clearMap(e);if(a==null){a=0.9}b.fillStyle="rgba(0,0,0,"+a+")";b.fillRect(0,0,b.canvas.width,b.canvas.height);c=core.clamp(c,0,1);b.globalCompositeOperation="destination-out";d.forEach(function(h){var j=h[0],k=h[1],i=h[2];var f=parseInt(i*c);var g=b.createRadialGradient(j,k,f,j,k,i);g.addColorStop(0,"rgba(0,0,0,1)");g.addColorStop(1,"rgba(0,0,0,0)");b.beginPath();b.fillStyle=g;b.arc(j,k,i,0,2*Math.PI);b.fill()});b.globalCompositeOperation="source-over"}},drawHero:function(){core.control.drawHero=function(k,h){if(!core.isPlaying()||!core.status.floorId||core.status.gameOver){return}var m=core.getHeroLoc("x"),n=core.getHeroLoc("y"),c=core.getHeroLoc("direction");k=k||"stop";h=h||0;var l=core.utils.scan[c];var d=l.x,e=l.y,i=d*h,j=e*h;core.bigmap.offsetX=core.clamp((m-core.__HALF_SIZE__)*32+i,0,32*core.bigmap.width-core.__PIXELS__);core.bigmap.offsetY=core.clamp((n-core.__HALF_SIZE__)*32+j,0,32*core.bigmap.height-core.__PIXELS__);core.clearAutomaticRouteNode(m+d,n+e);core.clearMap("hero");var a=core.getFlag("bgLight",[]);var b=core.getFlag("darkRatio",0);var f=core.getFlag("heroLight",0);var g=core.getFlag("lightRadius",0);this._drawHero_getDrawObjs(c,m,n,k,h).forEach(function(o){core.drawImage("hero",o.img,o.heroIcon[o.status]*o.width,o.heroIcon.loc*o.height,o.width,o.height,o.posx+(32-o.width)/2,o.posy+32-o.height,o.width,o.height);if(f){a.push([o.posx+16,o.posy+32-o.height+16,g]);core.plugin.drawLight("curtain",b,a);a.pop()}});core.control.updateViewport()}},setBgLight:function(){this.setBgLight=function(a){core.setFlag("bgLight",a!=null?a:[]);core.drawMap()}},specialColor:function(){core.ui._drawBook_drawRow1=function(g,e,j,h,k,i){core.setTextAlign("ui","left");var a=this._buildFont(13,true),f=this._buildFont(13,false);var b=h,c=h+k*9/25,d=h+k*17/25;core.fillText("ui","生命",b,i,"#A0F753",f);core.fillText("ui",core.formatBigNumber(e.hp||0),b+30,i,null,a);core.fillText("ui","攻",c,i,"#FF5555",f);core.fillText("ui",core.formatBigNumber(e.atk||0),c+15,i,null,a);core.fillText("ui","防",d,i,"#45D1E0",f);core.fillText("ui",core.formatBigNumber(e.def||0),d+15,i,null,a)};core.ui._drawBook_drawName=function(d,b,h,e,j){core.setTextAlign("ui","center");var a="#DDDDDD";var i=b.level;if(i=="萌新五段"||i=="萌新六段"||i=="萌新七段"){a="#56dc56"}else{if(i=="萌新八段"||i=="萌新九段"||i=="蓝海一阶"||i=="蓝海二阶"){a="#6b68ff"}else{if(i=="蓝海三阶"||i=="蓝海四阶"||i=="蓝海五阶"||i=="蓝海六阶"||i=="蓝海七阶"||i=="蓝海八阶"||i=="蓝海九阶"||i=="蓝海巅峰"){a="#b343e2"}else{if(i=="红海低阶"||i=="红海中阶"||i=="红海高阶"||i=="红海巅峰"||i=="半步血海"){a="#ff8be0"}else{if(i=="血海初成"||i=="血海大成"||i=="血海圆满"||i=="血海王者"){a="#ff4040"}}}}}var c=function(n){var l=core.enemys.getSpecials();for(var o=0;o<l.length;o++){var m=l[o];if(typeof(function(){})==typeof(m[1])){m[1]=m[1](b)}if(n==m[1]){if(m.length>3){return m[3]}else{return"#FF6A6A"}}}return"#FF6A6A"};if(b.specialText==""){core.fillText("ui",b.name,e+j/2,h+27,"#DDDDDD",this._buildFont(17,true));core.fillText("ui",b.level,e+j/2,h+51,a,this._buildFont(14,true))}else{core.fillText("ui",b.name,e+j/2,h+20,"#DDDDDD",this._buildFont(17,true));var k=b.specialText.indexOf(" ");if(k==-1){core.fillText("ui",b.specialText,e+j/2,h+38,c(b.specialText),this._buildFont(14,true))}else{var f=b.specialText.substr(0,k);var g=b.specialText.substr(k+2);core.fillText("ui",f,e+j/4,h+38,c(f),this._buildFont(14,true));core.fillText("ui",g,e+j*7/10,h+38,c(g),this._buildFont(14,true))}core.fillText("ui",b.level,e+j/2,h+56,a,this._buildFont(14,true))}};core.ui.drawBookDetail=function(k){var l=this._drawBookDetail_getInfo(k),h=l[0];if(!h){return}var i=l[0].special;if(typeof(i)==typeof(1)){i=[i]}var a=core.enemys.getSpecials();var c=[];var n=0;for(var q=0;q<a.length;q++){var g=a[q];if(i[n]==g[0]){if(g.length>3){c.push(a[q][3])}else{c.push("#FF6A6A")}n++}}var d=l[1].join("\n");core.status.event.id="book-detail";clearInterval(core.interval.tipAnimate);core.clearMap("data");var m=10,t=this.PIXEL-2*m,o=m+t;var e=m+25,s=o-e-13;var f=core.splitLines("data",d,s,this._buildFont(16,false));var j=Math.max(24*f.length+55,80),r=(this.PIXEL-j)/2,b=r+j;core.setAlpha("data",0.9);core.fillRect("data",m,r,t,j,"#000000");core.setAlpha("data",1);core.strokeRect("data",m-1,r-1,t+1,j+1,core.status.globalAttribute.borderColor,2);this._drawBookDetail_drawContent(h,f,{top:r,content_left:e,bottom:b},c)};core.ui._drawBookDetail_drawContent=function(d,c,h,a){core.setTextAlign("data","left");core.fillText("data",d.name,h.content_left,h.top+30,"#FFD700",this._buildFont(22,true));var b=h.top+57;var k=0;for(var e=0;e<c.length;e++){var l=c[e];var f=l.indexOf("：");if(f>=0){var m=l.substring(0,f+1);var j="";if(k<a.length){j=a[k]}else{j="#FF6A6A"}core.fillText("data",m,h.content_left,b,j,this._buildFont(16,true));var g=core.calWidth("data",m);core.fillText("data",l.substring(f+1),h.content_left+g,b,"#FFFFFF",this._buildFont(16,false));k++}else{core.fillText("data",c[e],h.content_left,b,"#FFFFFF",this._buildFont(16,false))}b+=24}};core.ui._drawBook_drawDamage=function(d,c,e,f){core.setTextAlign("ui","center");var b=c.damage,a="#FFFF00";if(b==null){b="无法战斗";a="#FF0000"}else{if(b>=core.status.hero.hp){a="#FF0000"}if(b<=0){a="#00FF00"}b=core.formatBigNumber(b);if(core.enemys.hasSpecial(c,124)||core.enemys.hasSpecial(c,19)){b+="+"}if(core.enemys.hasSpecial(c,126)||core.enemys.hasSpecial(c,127)){b+="-"}if(core.enemys.hasSpecial(c,11)){b+="^"}if(core.enemys.hasSpecial(c,122)){b+="*"}if(core.enemys.hasSpecial(c,14)||core.enemys.hasSpecial(c,109)){b+="~"}}if(c.notBomb){b+="[b]"}core.fillText("ui",b,e,f,a,this._buildFont(13,true))};core.enemys.getDamageString=function(c,e,f,d){if(typeof c=="string"){c=core.material.enemys[c]}var b=this.getDamage(c,e,f,d);var a="#000000";if(b==null){b="???";a="#FF0000"}else{if(b<=0){a="#00FF00"}else{if(b<core.status.hero.hp/3){a="#FFFFFF"}else{if(b<core.status.hero.hp*2/3){a="#FFFF00"}else{if(b<core.status.hero.hp){a="#FF7F00"}else{a="#FF0000"}}}}b=core.formatBigNumber(b,true);if(core.enemys.hasSpecial(c,124)||core.enemys.hasSpecial(c,19)){b+="+"}if(core.enemys.hasSpecial(c,126)||core.enemys.hasSpecial(c,127)){b+="-"}if(core.enemys.hasSpecial(c,11)){b+="^"}if(core.enemys.hasSpecial(c,122)){b+="*"}if(core.enemys.hasSpecial(c,14)||core.enemys.hasSpecial(c,109)){b+="~"}}return{damage:b,color:a}};core.ui._drawBookDetail_turnAndCriticals=function(c,d,e){var b=core.getDamageInfo(c,null,null,null,d);e.push("战斗回合数："+((b||{}).turn||0));var a=core.enemys.nextCriticals(c,5,null,null,d).map(function(f){return core.formatBigNumber(f[0])+":"+core.formatBigNumber(f[1])});while(a[0]=="0:0"){a.shift()}e.push("临界表："+JSON.stringify(a))}},setToolBarButton:undefined,checkMonster:function(){this.checkMonster=function(c){var e=[];var a=0;for(var d in c){var b=c[d];if(core.enemys.getCurrentEnemys(b).length>0){core.status.maps[b].blocks.forEach(function(f){if(core.isset(f.event)&&!f.disable){var h=f.event.id,g=core.material.enemys[h];if(core.isset(g)){a++;if(g.name in e){e[g.name]++}else{e[g.name]=1}}}})}}core.setFlag("remainMonsterInfo",this.printMonsterInfo(e));core.setFlag("remainMonsterCount",a);return};this.printMonsterInfo=function(a){var b="";for(var c in a){var d=a[c];b+="\n"+c+" * "+d}return b}}};